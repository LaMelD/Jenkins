# 3장 UNIX/Linux 기본 명령어와 개념

**기본 리눅스 명령어가 익숙한 독자는 4장으로 가서 쉘 스크립트 작성에 관련된 기본 문법을 숙달하는 것을 추천한다.**

### 3.1 입출력 재지정

|fd|fd 이름|용도|표준 장치|
|:---|:---|:---|:---|
|0|stdin(standard input)|명령어에 입력될 내용을 저장|키보드|
|1|stdout(standard output)|명령어에서 출력될 내용을 저장|화면|
|2|stderr(standard error)|명령어에서 출력될 에러 메시지를 저장|화면|

![std](../imgs/ch03/std-in-out-err.PNG)

![filestd](../imgs/ch03/filestd.PNG)
- 이렇게 키보드 같은 표준 입력 장치가 아닌 파일 등으로 재지정하는 것을 입력 재지정(input redirection)이라고 하고, 명령어의 실행 결과나 에러 메시지 같이 화면에 출력되는 것을 파일 등에 저장하는 것을 출력 재지정(output redirection)이라고 한다.
- 입출력 재지정
    - `<` : 입력 재지정
    - `>` : 출력 재지정
    - fd 번호를 받으시 붙여서 사용한다
    
    |형식|내용|
    |:---|:---|
    |명령어 fd 번호 < 파일|명령어에서 기본 지정된 파일이나 표준 입력 장치가 아닌 재지정된 파일에서 데이터를 입력받는다.|
    |명령어 fd 번호 > 파일|명령어에서 기본 지정된 파일이나 표준 출력 장치가 아닌 재지정된 파일에 데이터를 출력한다.|
    - 입출력 재지정을 사용할 때 fd 번호를 생략할 수 있다.

- 예시
    1. 입력
        
        ```
        명령어 < 파일
        명령어 0< 파일
        $ cat system
        Linux
        $ tr '[A-Z]' '[a-z]' < system
        linux
        ```

    2. 출력
        - `>` 이름이 같은 파일이 있다면 덮어쓰기
        - `>>` 이름이 같은 파일이 있다면 새로운 내용을 추가
        
        ```
        명령어 > 파일
        명령어 1> 파일
        명령어 >> 파일
        명령어 1>> 파일
        $ date > day-time
        $ cat day-time
        Sun Jul 19 13:14:15 UTC 2020
        $ date >> day-time
        $ cat day-time
        Sun Jul 19 13:14:15 UTC 2020
        Sun Jul 19 13:14:29 UTC 2020
        ```

        ```
        명령어 2> 파일
        명령어 2>> 파일
        ```

    3. 출력과 에러 메시지가 동일한 파일에 출력하도록 재지정할 수 있다.
        - 명령어의 중복을 막기 위해 이용할 수 있다.
        - `>&` : 기호 앞에 fd 번호 1은 생략이 가능하지만 기호 뒤에 fd 번호는 생략이 불가함을 기억해야 한다.

### 3.2 파이프 (Pipe)

- 앞의 명령어의 실행 결과가 뒤의 명령어에 입력되도록 입출력을 연결하는 연결하는 역할을 한다.
- 파이프의 역할은 출력 재지정과 유사하다.
    - 출력 재지정의 경우 하드디스크 같은 보조 기억 매체의 입출력 버퍼에 저장하고 재지정된 명령어에 전달하기 때문에 버퍼에 저장하고 처리하는데 시간이 걸린다.
    - 파이프의 경우, 여러 개의 명령어가 파이프로 실행될 때 이들 명령어가 거의 동식에 실행되면서 입출력되는 데이터들이 파이프로 연결되어 처리되므로 상대적으로 처리 시간이 빠른 것이 특징이다.

![pipe](../imgs/ch03/pipe.PNG)
- 명령어 a의 실행 결과를 명령어 b로 넘겨주고 최종적으로 명령어c에 의해 처리된 결과를 확인할 수 있다.
- 예시
    ```
    $ ls -l /var/log | sort -rk 9
    -rw-rw-r--  1 root      utmp              9984 Jul 19 13:14 wtmp
    drwxr-x---  2 root      adm               4096 Jul 16 09:24 unattended-upgrades
    -rw-------  1 root      root             64064 Jul 16 09:30 tallylog
    -rw-r-----  1 syslog    adm             244407 Jul 19 13:24 syslog
    drwxr-xr-x  2 root      root              4096 Nov 23  2018 lxd
    -rw-rw-r--  1 root      utmp            292292 Jul 19 13:14 lastlog
    drwxr-xr-x  2 landscape landscape         4096 Jul 16 09:36 landscape
    -rw-r-----  1 syslog    adm             151620 Jul 19 12:34 kern.log
    drwxr-sr-x+ 3 root      systemd-journal   4096 Jul 16 09:30 journal
    drwxr-xr-x  3 root      root              4096 Jul 16 09:27 installer
    -rw-r--r--  1 root      root             32032 Jul 16 09:30 faillog
    -rw-r--r--  1 root      root            535179 Jul 16 09:27 dpkg.log
    drwxr-xr-x  2 root      root              4096 Jan 24 11:47 dist-upgrade
    -rw-r--r--  1 root      root             11103 Jul 19 12:35 cloud-init-output.log
    -rw-r--r--  1 syslog    adm             211836 Jul 19 12:35 cloud-init.log
    -rw-rw----  1 root      utmp               384 Jul 19 12:31 btmp
    -rw-r--r--  1 root      root             56751 Feb  3 18:22 bootstrap.log
    -rw-r-----  1 syslog    adm               7084 Jul 19 13:17 auth.log
    drwxr-xr-x  2 root      root              4096 Jul 16 09:27 apt
    -rw-r--r--  1 root      root             27163 Jul 16 09:27 alternatives.log
    ```

### 3.3 UNIX/Linux 시스템 관리를 위한 기본 명령어

- 3.3.1 at 명령어
    - 명령어나 스크립트 파일이 특정 시간에 실행되도록 예약하는 기능을 수행한다.
    - 시스템 사용이 적은 시간 또는 필요한 시간에 지정된 작업을 자동으로 처리하고자 할 때 유용하다.
    - 사용 형식
        ```
        at [옵션] [시간] [날짜] [+증가시간]
        ```
    - 옵션
        
        |구분||설명|
        |:---|:---|:---|
        |옵션|-q queue|queue 이름을 지정한다.|
        ||-m|작업이 완료될 때 상요자에게 메일을 보낸다.|
        ||-f file|file에서 작업 목록을 보여준다.|
        ||-l|예약된 작업 목록을 보여준다.|
        ||-v|작업이 수행될 시간을 보여준다.|
        ||-d|예약된 작업을 삭제한다.|
        |시간|hh:mm|시간:분으로 설정한다.|
        ||am, pm|am, pm을 이용하여 12 단위로 시간을 표시한다.|
        |날짜|yyyy-mm-dd|년-월-일 구성으로 표현한다.|
        ||today, tommorrow|오늘, 내일로 지정할 때 사용한다.|
    - 예제
        - 지정된 시간에 This Time is를 화면에 표시하고 시간을 표시한다.
        - 작업 등록 후 `ctrl + d`를 누르면 편집줄 상태에서 빠져 나오면서 등록이 완료된다.
        ```
        $ at 21:40 2020-07-19
        at> echo "This Time is"
        at> date
        at> <EOT>
        job 1 at Sun Jul 19 21:40:00 2020
        $ at -l
        1       Sun Jul 19 21:40:00 2020 a root     # [작업 번호, 실행 날짜 및 시간, queue 이름, 예약 사용자] 순서
        ```
    - 추가적으로 at 명령어는 /etc/at.allow 와 /etc/at.deny 설정을 기반으로 예약 사용자들을 통제할 수 있다.
    - /etc/at.allow에 등록된 사용자가 at 명령어를 사용할 수 있다.
    - /etc/at.allow가 없으면 /etc/at.deny에 등록되지 않은 사용자만 사용할 수 있다.
    - 두 설정 파일이 없다면 root 사용자만 가능하다.
- 3.3.2 chmod 명령어
    - 파일, 디렉터리, 장치 등의 접근 권한(퍼미션)을 바꾼다.
    - 접근 권한은 소유자, 소유 그룹, 기타 사용자로 나누어 구분된다.
    - 각 항목별로 r, w, x 권한을 지정할 수 있다.
    - 사용 형식
        ```
        chmod [옵션] [퍼미션 값]
        chmod [옵션] [ugao] [+-=] [rwx]
        ```

        |권한 표기|권한|
        |:---|:---|
        |u|소유자|
        |g|소유자가 속한 그룹|
        |o|기타 소유자|
        |a|u, g, o 모두|
        |+|허가 추가|
        |-|허가 삭제|
        |=|옵션 이외는 모두 취소(절대 옵션)|
        |r|읽기 허가|
        |w|쓰기 허가|
        |x|실행 허가|
    - 예시
        ```
        $ ls -al file
        -rwxr-xr-x 1 root root 0 Jul 19 14:40 file
        $ chmod a-r file
        $ ls -al file
        --wx--x--x 1 root root 0 Jul 19 14:40 file
        $ chmod 755 file
        $ ls -al file
        -rwxr-xr-x 1 root root 0 Jul 19 14:40 file
        ```
- 3.3.3 chown 명령어
    - 파일 소유자 및 소유 그룹을 바꾸기 위한 명령으로, 시스템 최고 관리자인 root만이 명령어를 사용할 수 있다.
    - -R 옵션으로 특정 디렉토리에 있는 모든 파일의 접근 권한을 변경할 수 있다.
    - 사용 형식
        ```
        chown [옵션] [소유자].[그룹]
        ```
    - 예시
        ```
        $ chown user01.user01 file
        ```
- 3.3.4 cmp 명령어
    - 파일을 비교하여 서로 다른 부분을 알려주는 명령어로 다음에 살펴볼 diff 명령어와 유사하다.
    - 차이점의 유무만을 나타낸다.
    - 사용 형식
        ```
        cmp [옵션] file1 file2
        ```
    - 옵션
        - -l : 각 파일의 서로 다른 바이트 번호를 나타낸다.
        - -s : 메시지에 의한 표시 대신 차이가 없으면 0, 차이가 있으면 1을 남긴다.
- 3.3.5 col 명령어
    - 텍스트 파일 내 개행(특수) 문자와 공 백 등을 변환하는 필터 역할을 한다.
    - \n\r 문자를 \n 문자로 변환하거나 공백 문자를 탭 문자로 변환할 때 사용한다.
    - 사용 형식
        ```
        col [옵션]
        ```
    - 주요 옵션
        
        |옵션|설명|
        |:---|:---|
        |-b|백스페이스 문자는 출력하지 않고 백스페이스 문자와 연결되는 마지막 문자만 출력한다.|
        |-f|밑줄 속성을 가진 문자열을 변환하지 않는다.|
        |-h|중복되는 공백을 출력하지 않고 탭으로 변환한다.|
        |-x|중복되는 공백 문자를 그대로 둔다.|
        |-l 숫자|버퍼 값을 지정하여 메모리에 상주할 수 있는 최대 줄 수를 지정한다.|
    - 예시
        ```
        # col의 man 페이지를 파일로 변환하여 저장한다.
        $ man col | col > col.man
        ```
    - col을 이용해 개행문자를 정리하는 것도 시스템 관리를 위해 유용하다.
- 3.3.6 colcrt 명령어
    - 밑줄(_)을 감추거나 변환한다.
    - 사용 형식
        ```
        colcrt [옵션]
        ```
    - 주요 옵션
        - `-` : 밑줄 속성이 있는 문자열을 표시하지 않는다.
        - `-2` : 밑줄 속성이 있는 문자열 다음 줄에 하이픈(-)을 포함하여 표시한다.
    - 예시
        ```
        $ cat colcrt.test
        Linux_UNIX_Shell Script
        $ colcrt colcrt.test
        Linux UNIX Shell Script
        -    -
        $ colcrt - colcrt.test
        Linux UNIX Shell Script
        $ colcrt -2 colcrt.test
        
        Linux UNIX Shell Script
            -    -
        ```
- 3.3.7 cp 명령어
    - 특정 파일을 현재 디렉토리나 다른 디렉토리로 복사한다.
    - 사용 형식
        ```
        cp [옵션] 파일명1 파일명2
        ```
    - 주요 옵션
        
        |옵션|설명|
        |:---|:---|
        |-a|원본 파일의 속성, 구조 등을 그대로 유지하면서 복사한다.|
        |-b|복사할 때 같은 이름의 파일이 있으면 백업본을 만든다.|
        |-d|복사할 때 파일이 심볼릭 링크 파일이면 심볼릭 링크의 대상 파일을 복사한다.|
        |-f|복사 대상 파일이 있으면 지우고 복사한다.|
        |-i|복사 시 같은 파일이 있으면 덮어쓸지를 확인한다.|
        |-P|원본 파일의 소유자, 그룹, 권한, 시간 기록을 그대로 복사한다.|
        |-r|디렉터리의 하위 디렉터리의 파일 및 디렉터리까지 복사한다.|
- 3.3.8 cut 명령어
    - 텍스트 파일이나 파이프된 결과 중에 지정된 부분만 표시한다.
    - 시스템 관리 실무에서 awk 명령어와 더불어 텍스트 파일 출력 편집용으로 많이 사용된다.
    - 별도의 구분자 없이 사용했을 때는 바이트 단위로 구분하지만 별도의 구분자를 지정하였을 경우 지정한 구분자를 기준으로 표시한다.
    - 사용 형식
        ```
        cut [옵션]
        ```
    - 주요 옵션
        |옵션|설명|
        |:---|:---|
        |-b|바이트 단위로 나타낸다.|
        |-c|문자 단위로 나타낸다.|
        |-d|기본 필드 구분자인 탭 대신 지정된 구분자를 이용한다.|
        |-f|지정된 필드만 구성하여 표시한다.|
        |-s|필드 구분자에 포함되어 있지 않은 행은 표시하지 않는다.|
    - -b, -c, -f 옵션에서는 숫자 범위를 지정할 수 있다.
        |구분|설명|
        |:---|:---|
        |A|A번째|
        |A-|A번째 부터|
        |A-B|A부터 B까지|
        |-B|B까지|
- 3.3.9 date 명령어
- 3.3.10 df 명령어
- 3.3.11 diff 명령어
- 3.3.12 domainname 명령어
- 3.3.13 du 명령어
- 3.3.14 echo 명령어
- 3.3.15 find 명령어
- 3.3.16 free 명령어
- 3.3.17 ftp 명령어
- 3.3.18 ifconfig 명령어
- 3.3.19 grep 명령어
- 3.3.20 logger 명령어
- 3.3.21 lsof 명령어
- 3.3.22 netstat 명령어
- 3.3.23 nl 명령어
- 3.3.24 ntpdate 명령어
- 3.3.25 ping 명령어
- 3.3.26 pmap 명령어
- 3.3.27 pr 명령어
- 3.3.28 ps 명령어
- 3.3.29 pwd 명령어
- 3.3.30 route 명령어
- 3.3.31 script 명령어
- 3.3.32 sort 명령어
- 3.3.33 tail 명령어
- 3.3.34 tar 명령어
- 3.3.35 time 명령어
- 3.3.36 touch 명령어
- 3.3.37 tr 명령어
- 3.3.38 traceroute 명령어
- 3.3.39 uptime 명령어
- 3.3.40 vmstat 명령어
- 3.3.41 w 명령어

### 3.4 스트림 편집기 sed

### 3.5 awk

- 3.5.1 awk의 필드 인식 구조
- 3.5.2 awk에서 활용 가능한 정규 표현식
- 3.5.3 awk의 조건문
- 3.5.4 BEGIN / END 표현식
- 3.5.5 파이프 라인

### 3.6 vi 편집기

- 3.6.1 vi 모드
- 3.6.2 vi 종료하고 파일 저장하기
- 3.6.3 커서 이동하기
- 3.6.4 수정 및 삭제
- 3.6.5 복사하기와 붙이기
- 3.6.6 환경 설정